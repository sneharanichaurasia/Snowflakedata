-- Crateing IMPORT_WH warehouse
create warehouse IMPORT_WH 
warehouse_size=medium 
max_cluster_count= 1
Auto_SUSPEND=300
INITIALLY_SUSPENDED=TRUE;



-- Crateing TRANSFORM_WH warehouse

create warehouse TRANSFORM_WH 
warehouse_size=medium 
max_cluster_count= 1
Auto_SUSPEND=300
INITIALLY_SUSPENDED=TRUE;

-- Crateing REPORTING_WH warehouse


CREATE WAREHOUSE REPORTING_WH
WAREHOUSE_SIZE = SMALL
AUTO_SUSPEND=900
MAX_CLUSTER_COUNT = 5
INITIALLY_SUSPENDED = TRUE;

-- List of warehouse
SHOW WAREHOUSES;

-- Creating databases
create database STAGING;
create database PROD;

-- using IMPORT_WH 
use WAREHOUSE IMPORT_WH;

use database STAGING;

-- Creating schema

CREATE SCHEMA RAW 
DATA_RETENTION_TIME_IN_DAYS = 3;

CREATE SCHEMA CLEAN 
DATA_RETENTION_TIME_IN_DAYS = 3;

-- changing the database
USE WAREHOUSE REPORTING_WH;
USE DATABASE PROD;

-- Creating schema
CREATE OR REPLACE
SCHEMA REPORTING
DATA_RETENTION_TIME_IN_DAYS = 90;

USE ROLE SECURITYADMIN;


-- Create the role
CREATE ROLE IMPORT_ROLE;
-- Create the user

CREATE OR REPLACE USER IMPORT_USER 
  PASSWORD='ABC123' 
  DEFAULT_ROLE=IMPORT_ROLE;



-- Grant USAGE only on the warehouse "IMPORT_WH"
GRANT USAGE ON WAREHOUSE IMPORT_WH TO ROLE IMPORT_ROLE;

USE WAREHOUSE IMPORT_WH;
USE ROLE SYSADMIN;
USE DATABASE STAGING;


-- Grant USAGE on the STAGING_DB database
GRANT USAGE ON DATABASE STAGING TO ROLE IMPORT_ROLE;

-- Grant full access to RAW schema in STAGING
GRANT ALL PRIVILEGES ON SCHEMA STAGING.RAW TO ROLE IMPORT_ROLE;

-- Grant full access to CLEAN schema in STAGING
GRANT ALL PRIVILEGES ON SCHEMA STAGING.CLEAN TO ROLE IMPORT_ROLE;
 

---------------------------------------------------------------------------------------------------

-- USE WAREHOUSE TRANFORM_WH
USE ROLE SYSADMIN;
USE WAREHOUSE TRANSFORM_WH;

USE ROLE SECURITYADMIN;
-- Create the role

CREATE ROLE TRANSFORM_ROLE;


GRANT USAGE ON SCHEMA STAGING.Clean TO ROLE TRANSFORM_ROLE;


-- Create the users
CREATE USER DATAENGINEER 
  PASSWORD='ABC123' 
  DEFAULT_ROLE=TRANSFORM_ROLE;

CREATE USER ETLADMIN 
  PASSWORD='ABC123' 
  DEFAULT_ROLE=TRANSFORM_ROLE;

CREATE USER POWERUSER 
  PASSWORD='ABC123' 
  DEFAULT_ROLE=TRANSFORM_ROLE;
  
-- Assign roles to the users
GRANT ROLE TRANSFORM_ROLE TO USER DATAENGINEER;
GRANT ROLE TRANSFORM_ROLE TO USER ETLADMIN;
GRANT ROLE TRANSFORM_ROLE TO USER POWERUSER;


GRANT USAGE ON WAREHOUSE TRANSFORM_WH TO ROLE TRANSFORM_ROLE;

GRANT USAGE ON SCHEMA PROD.REPORTING TO ROLE TRANSFORM_ROLE;


_________________________________________________________________________________________________________
USE ROLE SYSADMIN;

USE WAREHOUSE REPORTING_WH;
USE DATABASE PROD;


USE ROLE SECURITYADMIN;

-- Create the role
CREATE ROLE REPORTING_ROLE;

-- Create the user

CREATE USER BIUSER 
  PASSWORD='ABC123' 
  DEFAULT_ROLE=REPORTING_WH;

SHOW WAREHOUSE;
  
-- Grant usage only on the warehouse "REPORTING_WH"
GRANT USAGE ON WAREHOUSE REPORTING_WH TO ROLE REPORTING_ROLE;

GRANT USAGE ON DATABASE PROD TO ROLE REPORTING_ROLE;
GRANT USAGE ON SCHEMA PROD.REPORTING TO ROLE REPORTING_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA PROD.REPORTING TO ROLE REPORTING_ROLE;

--------------------------------------------------------------------------------
-- USERS (Test Users)

SHOW WAREHOUSES;
USE WAREHOUSE reporting_wh;
show databases;
use database PROD;



GRANT USAGE ON DATABASE prod TO ROLE REPORTING_ROLE;
GRANT USAGE ON SCHEMA PROD.REPORTING TO ROLE REPORTING_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA PROD.REPORTING TO ROLE REPORTING_ROLE;



SHOW WAREHOUSES;
USE WAREHOUSE TRANSFORM_WH;
show databases;
use database STAGING;


GRANT USAGE ON DATABASE STAGING TO ROLE TRANSFORM_ROLE;
GRANT USAGE ON SCHEMA STAGING.CLEAN TO ROLE TRANSFORM_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA STAGING.CLEAN TO ROLE TRANSFORM_ROLE;



SHOW WAREHOUSES;

show databases;
use database STAGING;

GRANT USAGE ON DATABASE STAGING TO ROLE IMPORT_ROLE;
GRANT USAGE ON SCHEMA STAGING.CLEAN TO ROLE IMPORT_ROLE;
GRANT USAGE ON SCHEMA STAGING.RAW TO ROLE IMPORT_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA STAGING.RAW TO ROLE IMPORT_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA STAGING.CLEAN TO ROLE IMPORT_ROLE;

-----------------------------------------------------------------------------------------------------------
-- USAGE MONITORS


use role accountadmin;
-- Create an IMPORT_MONITOR

CREATE OR REPLACE RESOURCE MONITOR IMPORT_MONITOR
WITH CREDIT_QUOTA=100;



-- Create a TRANSFORM_MONITOR
CREATE OR REPLACE RESOURCE MONITOR TRANSFORM_MONITOR
WITH CREDIT_QUOTA=100;



-- Create a REPORTING_MONITOR
CREATE OR REPLACE RESOURCE MONITOR REPORTING_MONITOR
WITH CREDIT_QUOTA=100;




